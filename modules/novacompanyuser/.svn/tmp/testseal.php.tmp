<?php
function novacompanyuser_testsealInner()
{
  $server = $_SERVER["HTTP_HOST"];
  $disableTextarea = "";
  if ($server == "www.testsystem.de.bankingcheck.nova-web.de") {
    drupal_set_message("Achtung: Die Ausgabe des Testsystems enthält Passwörter. Nicht weitergeben!", 'warning');
    $server = "bankingcheck:YhThI1Wg4rPynfishj@www.testsystem.de.bankingcheck.nova-web.de";
    drupal_add_js('$(document).ready(function() {
  $("name=[\"text\"]").bind("copy paste cut",function(e) {
    e.preventDefault(); //this line will help us to disable cut,copy,paste
  });
});', 'inline');
    $disableTextarea= " disabled='disabled' title='Das Kopieren wurde auf dem Testsystem aus Sicherheitsgründen deaktiviert' ";
  }
	$html = '<div class="node-type-bank">
	<h1>BankingCheck Testsiegel- & Widget Generator / SEO Optimierung</h1>
<p>Hier können Sie sich den Quellcode für Anbieter- und Produkttestsiegel generieren, um diesen in Ihre Internetseiten und auf Landingpages zu integrieren.</p>

<p>Sie können das jeweilige Produkt oder Anbieter auswählen und das Widget nach Ihren Wünschen optimal anpassen, bspw. mit Ausgabe der Bewertungen oder Bewertungsabgabe direkt in Ihrer Seite per PopUp.</p>

<h2>SEO Optimierung - Anzeige von Google Sternen</h2>
<p>Für die Ausgabe von Google Sternen (auch in anderen Suchmaschinen) in den generischen Suchergebnissen, nutzen Sie bitte das php include mit RichSnippet Funktion.</p>

<p>Bei Fragen wenden Sie sich bitte an <a href="mailto:widget@bankingcheck.de">widget@bankingcheck.de</a></p>

<form name="widget" action="'.$PHP_SELF.'" method="post">
<strong>Bank- oder Produkt: </strong>';
	# load bankId and its products
	$novaBCUser = NovaBCUser::buildUser($GLOBALS['user']->uid);
	$myProducts = $novaBCUser->getMyProducts();
	if (count($myProducts)>0) {
		$html .='<select name="productid">';
    $selectedId = intval($_POST['productid']);
    $html .= '<option value="10'.$novaBCUser->getMyBankNode()->field_financeaddsid[0]["value"].'"';
    if ($selectedId == '10'.$novaBCUser->getMyBankNode()->field_financeaddsid[0]["value"]) $html .= ' selected="selected"';
    $html .= '>'.$novaBCUser->getMyBankNode()->title.'</option>';
    foreach ($myProducts as $key => $product) {
			$html .= '<option value="'.$product->field_prodfinanceaddsid[0]["value"].'"';
      if ($selectedId == $product->field_prodfinanceaddsid[0]["value"]) $html .= ' selected="selected"';
      $html .='>'.$product->title.'</option>';
		}
		$html .= '</select>';
	} else {
		$html .='<input name="productid" type="hidden" value="10'.$novaBCUser->getMyBankNode()->field_financeaddsid[0]["value"].'" />'.$novaBCUser->getMyBankNode()->title;
	}
//Vorabfrage counter
if (empty($_POST) OR (isset($_POST['votebutton'])))
{
  $checkbox11="checked";
}
else
{
  $checkbox11="";
}
if (empty($_POST) OR (isset($_POST['ankervote'])))
{
  $checkbox5="checked";
  $checkbox11="checked";
}
else
{
  $checkbox5="";
}

if (empty($_POST) OR (isset($_POST['votecount'])))
{
  $checkbox12="checked";
  $checkbox11="checked";
}
else
{
  $checkbox12="";
}
if (empty($_POST) OR (isset($_POST['ankercount'])))
{
  $checkbox13="checked";
  $checkbox12="checked";
  $checkbox11="checked";
}
else
{
  $checkbox13="";
}

if (empty($_POST) OR (isset($_POST['snippetdata'])))
{
  $checkbox2="checked";
  $checkboxtemp="";
}
else
{
  $checkbox2="";
  $checkboxtemp="checked";
}
if (empty($_POST) OR (isset($_POST['phpinclude'])) OR (isset($_POST['snippetdata'])))
{
  $checkbox3="checked";
  $checkboxtemp="";
}
else
{
  $checkbox3="";
  $checkboxtemp="checked";
}
if (isset($_POST['popup']))
{
  $checkbox1="checked";
  $checkbox4="checked";
  $checkbox41="";
  $checkbox5="";
}
else
{
  $checkbox4="";
}
if (isset($_POST['popupClean']))
{
  $checkbox1="checked";
  $checkbox4="";
  $checkbox41="checked";
  $checkbox5="";
}
else
{
  $checkbox41="";
}
if (empty($_POST) OR isset($_POST['ankervote']))
{
  $checkbox5="checked";
  $checkbox11="checked";
}
else
{
  $checkbox4="";
  $checkbox41="";
  $checkbox5="";
}

if (empty($_POST) OR isset($_POST['ankerimage']))
{
  $checkbox51="checked";
}
else
{
  $checkbox51="";
}

$html .= '
<br/><br/>

 <fieldset>
  <legend>Einbindung des Widget:</legend>
<input name="javascript-use" type="checkbox" value="JavaScript Integration"
'.$checkboxtemp.' />JavaScript Integration<br/>
<input name="snippetdata" type="checkbox" value="Rich Snippet Daten ausgeben"
'.$checkbox2.' />Rich Snippet Daten ausgeben<br/>
<input name="phpinclude" type="checkbox" value="php-include verwenden"
'.$checkbox3.' />php-include verwenden (bei Rich-Snippet Daten ist dies Pflicht !)<br/>
 </fieldset>

<fieldset>
  <legend>KlickEvents & Optionen:</legend>
  <input name="ankerimage" type="checkbox" value="Image klickbar"
'.$checkbox51.' />Testsiegel klickbar<br/><hr/>
<input name="votebutton" type="checkbox" value="Button ja/nein"
'.$checkbox11.' />Bewerten Link anzeigen</br>
<input name="ankervote" type="checkbox" value="Link klickbar"
'.$checkbox5.' />Bewerten Link klickbar<br/><hr/>
<input name="votecount" type="checkbox" value="Anzahl ja/nein"
'.$checkbox12.' />Anzahl Bewertungen anzeigen</br>
<input name="ankercount" type="checkbox" value="Anzahl klickbar"
'.$checkbox13.' />Anzahl Bewertungen klickbar</br>

 </fieldset>

<fieldset>
  <legend>Popup:</legend>
<input name="popup" type="checkbox" value="Bewertungsmaske im neuen Fenster"
'.$checkbox4.' />Bewertungsmaske als Popup mit BankingCheck Brand<br/>
<input name="popupClean" type="checkbox" value="Bewertungsmaske im neuen Fenster ohne Branding" '.$checkbox41.'
/>Bewertungsmaske als Popup ohne BankingCheck Brand<br/>
 </fieldset>
<input name="submit" type="submit" value="Widget generieren und Code erzeugen" /><br/><br/>';

if (isset($_POST['submit']))
{
$count="&counter=true";

$votebutton="&votebutton=true";
//votebutton abfragen
if(isset($_POST['votebutton']))
  $votebutton="&votebutton=true";
else
{
  $votebutton="&votebutton=false";
  $ankervote="&ankervote=false";
}

$votecount="&votecount=true";
//votecount abfragen
if(isset($_POST['votecount']))
  $votecount="&votecount=true";
else
{
  // xxx ggf noch für neu
  $votecount="&votecount=false";
}

$snippet="&snippet=true";
//snippet abfragen
if (isset($_POST['snippetdata']))
  $snippet="&snippet=true";
else
  $snippet="&snippet=false";

$phpinc = True;
//snippet abfragen
if (isset($_POST['phpinclude']) OR isset($_POST['snippetdata']))
  $phpinc = True;
else
  $phpinc = False;

$popup="&popup=true";
//popupabfragen
if (isset($_POST['popup']))
{
  $count="&counter=true";
  $popup="&popup=true";
  $popupClean="&popupClean=false";
}
else
  $popup="&popup=false";

$popupClean="&popupClean=true";
//popupabfragen
if (isset($_POST['popupClean']))
{
  $count="&counter=true";
  $popup="&popup=false";
  $popupClean="&popupClean=true";
}
else
  $popupClean="&popupClean=false";

//ankervote abfragen
if (isset($_POST['ankervote']))
{
  $ankervote="&ankervote=true";
  $votebutton="&votebutton=true";
}
else
  $ankervote="&ankervote=false";

//ankercount abfragen
if (isset($_POST['ankercount']))
{
  $ankercount="&ankercount=true";
  $votecount="&votecount=true";
}
else
  $ankercount="&ankercount=false";

if(isset($_POST['ankerimage']))
  $ankerimage="&ankerimage=true";
else
  $ankerimage="&ankerimage=false";



// Quellcode Berechnungen
$id = $_POST['productid'];
$url1 = "http://".$server."/BewertungsWidget/generator.php?productid=";
$final1 = $url1 . $id . $count . $snippet . $popup . $popupClean . $ankervote .$ankerimage . $votebutton . $votecount . $ankercount;


// Vorschau Berechnungen
$url2 = "http://".$server."/BewertungsWidget/bw_widget.php?productid=";
$final2 = $url2 . $id . $count . $snippet . $popup . $popupClean . $ankervote . $ankerimage . $votebutton . $votecount . $ankercount;

// Quellcode für php-include
// ohne ssl
$url31 = "http://".$server."/BewertungsWidget/bw_widget.php?ssl=no&productid=";
$final31 = $url31 . $id . $count . $snippet . $popup . $popupClean . $ankervote . $ankerimage . $votebutton . $votecount . $ankercount;

// mit ssl
$url32 = "https://".$server."/BewertungsWidget/bw_widget.php?ssl=yes&productid=";
$final32 = $url32 . $id . $count . $snippet . $popup . $popupClean . $ankervote . $ankerimage . $votebutton . $votecount . $ankercount;

// html Inhalte holen
if ($phpinc)
{
$code31 = "include '" . $final31 . "'; ";
$code32 = "include '" . $final32 . "'; ";
$code = "<?php if (!\$_SERVER['HTTPS']) {" . $code31 ."} else {" . $code32 ."} ?>";

}
else
{
  $code = file_get_contents($final1);
}
$preview = file_get_contents($final2);

if (empty($preview))
{
$preview = "Widget wurde noch nicht freigegeben, bitten wenden Sie sich zwecks Angebots an <a href='mailto:kontakt@bankingcheck.de?subject=BankingCheck%20Widget%20Freischaltung&Body=Sehr%20geehrtes%20BankingCheck%20Team,%0D%0A%0D%0Abitte%20schalten%20Sie%20uns%20für%20folgende%20Produkte%20frei:%0D%0A%0D%0A...%20bitte%20Produkte%20oder%20Anbieter%20eintragen%20...'>kontakt@bankingcheck.de</a>."; # .$final2;
$code = "Widget wurde noch nicht freigegeben, bitten wenden Sie sich zwecks Angebots sich an kontakt@bankingcheck.de.";
}
else if ($phpinc)
{
  //nix abschneiden...
}
else
{
// Nachbearbeitung des Quellcodes
$startpos = strpos($code ,'<pre>');
$startpos+=7;
$endpos = strpos($code ,'</pre>');
$endpos-=1;
$length = $endpos-$startpos;
$substr = substr($code ,$startpos, $length);
$code = $substr;
}

}
else
{
// beim ersten Aufruf
$code = "Ausgabe des Quellcode";
$preview = "";
$_POST['snippetdata'] = "checked";
$_POST['phpinclude'] = "checked";
$_POST['ankerimage'] = "checked";
$_POST['votebutton'] = "checked";
$_POST['ankervote'] = "checked";
$_POST['votecount'] = "checked";
$_POST['ankercount'] = "checked";
}

$html .='<p><strong>Quellcode für Ihre Seite:</strong></p>
<textarea style="width: 98%" rows="10" name="text" '.$disableTextarea.'>
'.$code.'
</textarea>

<p><strong>Vorschau</strong></p>
'.$preview.'

</form>

	</div>';

	return $html;
}
?>